import { AppendRecord } from "./utils.js";
export interface BatchTransformArgs {
    /** Duration in milliseconds to wait before flushing a batch (default: 5ms) */
    lingerDurationMillis?: number;
    /** Maximum number of records in a batch (default: 1000, max: 1000) */
    maxBatchRecords?: number;
    /** Maximum batch size in metered bytes (default: 1 MiB, max: 1 MiB) */
    maxBatchBytes?: number;
    /** Optional fencing token to enforce (remains static across batches) */
    fencing_token?: string;
    /** Optional sequence number to match for first batch (auto-increments for subsequent batches) */
    match_seq_num?: number;
}
/** Batch output type with optional fencing token and match_seq_num */
export type BatchOutput = {
    records: AppendRecord[];
    fencing_token?: string;
    match_seq_num?: number;
};
/**
 * A TransformStream that batches AppendRecords based on time, record count, and byte size.
 *
 * Input: AppendRecord (individual records)
 * Output: { records: AppendRecord[], fencing_token?: string, match_seq_num?: number }
 *
 * @example
 * ```typescript
 * const batcher = new BatchTransform<"string">({
 *   lingerDuration: 20,
 *   maxBatchRecords: 100,
 *   maxBatchBytes: 256 * 1024,
 *   match_seq_num: 0  // Optional: auto-increments per batch
 * });
 *
 * // Pipe through the batcher and session to get acks
 * readable.pipeThrough(batcher).pipeThrough(session).pipeTo(writable);
 *
 * // Or use manually
 * const writer = batcher.writable.getWriter();
 * writer.write(AppendRecord.make("foo"));
 * await writer.close();
 *
 * for await (const batch of batcher.readable) {
 *   console.log(`Got batch of ${batch.records.length} records`);
 * }
 * ```
 */
export declare class BatchTransform extends TransformStream<AppendRecord, BatchOutput> {
    private currentBatch;
    private currentBatchSize;
    private lingerTimer;
    private controller;
    private readonly maxBatchRecords;
    private readonly maxBatchBytes;
    private readonly lingerDuration;
    private readonly fencing_token?;
    private next_match_seq_num?;
    constructor(args?: BatchTransformArgs);
    private handleRecord;
    private flush;
    private startLingerTimer;
    private cancelLingerTimer;
}
//# sourceMappingURL=batch-transform.d.ts.map